#!/bin/bash
# Script para actualizar el servidor EC2 con onboarding completo funcionando

echo "üöÄ Actualizando servidor EC2 con onboarding completo..."
echo "============================================================"

# Configuraci√≥n
EC2_IP="3.141.40.201"
EC2_USER="ubuntu"

echo "‚ö†Ô∏è  Necesitas ejecutar estos comandos manualmente en el servidor EC2:"
echo ""
echo "1. Conectarse al servidor:"
echo "   ssh -i tu-clave.pem ubuntu@${EC2_IP}"
echo ""
echo "2. Ir al directorio del proyecto:"
echo "   cd /home/ubuntu/vantage-backend"
echo ""
echo "3. Actualizar c√≥digo desde GitHub:"
echo "   git pull origin main"
echo ""
echo "4. Limpiar cach√© de Next.js:"
echo "   cd vantageai-frontend"
echo "   rm -rf .next"
echo "   cd .."
echo ""
echo "5. Reconstruir contenedores Docker:"
echo "   docker compose down"
echo "   docker compose up --build -d"
echo ""
echo "6. Esperar que los servicios est√©n listos (30 segundos):"
echo "   sleep 30"
echo ""
echo "7. Verificar estado:"
echo "   docker compose ps"
echo "   curl http://localhost:5002/health"
echo ""
echo "‚úÖ Despu√©s de estos pasos, el onboarding completo deber√≠a funcionar en:"
echo "   http://${EC2_IP}:3000"
echo ""
echo "üß™ Para probar el onboarding completo:"
echo ""
echo "   CLIENTE:"
echo "   1. Ve a http://${EC2_IP}:3000"
echo "   2. Inicia sesi√≥n con: cliente1@mineraandes.cl / password123"
echo "   3. Si has_completed_onboarding = False ‚Üí ver√°s onboarding del cliente"
echo "   4. Si has_completed_onboarding = True ‚Üí ver√°s dashboard del cliente"
echo ""
echo "   PROVEEDOR:"
echo "   1. Ve a http://${EC2_IP}:3000"
echo "   2. Inicia sesi√≥n con: juan.perez@solucioneshidraulicas.cl / password123"
echo "   3. Si has_completed_onboarding = False ‚Üí ver√°s onboarding del proveedor"
echo "   4. Si has_completed_onboarding = True ‚Üí ver√°s dashboard del proveedor"
echo ""
echo "üîÑ Para resetear onboarding y probar desde cero:"
echo "   curl -X PUT http://localhost:5002/api/users/reset-onboarding \\"
echo "     -H 'Authorization: Bearer TU_TOKEN'"
echo ""
echo "üìã CAMBIOS IMPLEMENTADOS:"
echo "‚úÖ Onboarding del cliente (4 pasos)"
echo "‚úÖ Onboarding del proveedor (4 pasos)"
echo "‚úÖ Redirecci√≥n autom√°tica basada en has_completed_onboarding"
echo "‚úÖ Tour guiado para cliente y proveedor"
echo "‚úÖ Componentes separados para evitar bucles"
echo "‚úÖ Debug logs para troubleshooting"
echo ""
echo "üéØ NO SE NECESITAN MIGRACIONES:"
echo "   - Se usa el campo has_completed_onboarding existente"
echo "   - No hay cambios en la estructura de la base de datos"
echo "   - Solo actualizaci√≥n de c√≥digo frontend y backend" 