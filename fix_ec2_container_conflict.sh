#!/bin/bash
# Script para solucionar conflicto de contenedores en EC2

echo "üîß Solucionando conflicto de contenedores en EC2..."
echo "============================================================"

# Configuraci√≥n
EC2_IP="3.141.40.201"
EC2_USER="ubuntu"

echo "‚ö†Ô∏è  Necesitas ejecutar estos comandos manualmente en el servidor EC2:"
echo ""
echo "1. Conectarse al servidor:"
echo "   ssh -i tu-clave.pem ubuntu@${EC2_IP}"
echo ""
echo "2. Ir al directorio del proyecto:"
echo "   cd /home/ubuntu/vantage-backend"
echo ""
echo "3. Verificar contenedores actuales:"
echo "   docker compose ps"
echo ""
echo "4. Detener TODOS los contenedores (incluyendo prod):"
echo "   docker compose down"
echo "   docker compose -f docker-compose.prod.yml down"
echo ""
echo "5. Verificar que no hay contenedores ejecut√°ndose:"
echo "   docker ps"
echo ""
echo "6. Actualizar c√≥digo desde GitHub:"
echo "   git pull origin main"
echo ""
echo "7. Limpiar cach√© de Next.js:"
echo "   cd vantageai-frontend"
echo "   rm -rf .next"
echo "   cd .."
echo ""
echo "8. Reconstruir contenedores Docker:"
echo "   docker compose up --build -d"
echo ""
echo "9. Esperar que los servicios est√©n listos (30 segundos):"
echo "   sleep 30"
echo ""
echo "10. Verificar estado:"
echo "    docker compose ps"
echo "    curl http://localhost:5002/health"
echo ""
echo "‚úÖ Despu√©s de estos pasos, el dise√±o completo deber√≠a funcionar en:"
echo "   http://${EC2_IP}:3000"
echo ""
echo "üîß PROBLEMA IDENTIFICADO:"
echo "   - Contenedores de producci√≥n (prod) ocupando puertos"
echo "   - Conflicto entre docker-compose.yml y docker-compose.prod.yml"
echo "   - Puerto 5002 ya est√° en uso"
echo ""
echo "üéØ SOLUCI√ìN:"
echo "   - Detener TODOS los contenedores"
echo "   - Limpiar cach√© de Next.js"
echo "   - Reconstruir con el nuevo c√≥digo"
echo ""
echo "üß™ Para probar el dise√±o completo:"
echo ""
echo "   1. Ve a http://${EC2_IP}:3000"
echo "   2. Inicia sesi√≥n con: cliente1@mineraandes.cl / password123"
echo "   3. Navega a:"
echo "      - Productos: /client/products"
echo "      - Servicios: /client/services"
echo "   4. Prueba los filtros y b√∫squedas"
echo "   5. Observa las animaciones hover"
echo ""
echo "üìã CAMBIOS IMPLEMENTADOS:"
echo "‚úÖ Onboarding completo (cliente y proveedor)"
echo "‚úÖ Dise√±o moderno de tarjetas"
echo "‚úÖ Animaciones y efectos visuales"
echo "‚úÖ Lazy loading optimizado"
echo "‚úÖ Skeletons precisos"
echo "‚úÖ Responsive design"
echo "‚úÖ TypeScript interfaces"
echo "‚úÖ Performance optimizations"
echo "‚úÖ package-lock.json incluido"
echo ""
echo "üéØ NO SE NECESITAN MIGRACIONES:"
echo "   - Solo cambios de frontend"
echo "   - Backend sin modificaciones"
echo "   - Base de datos sin cambios"
echo ""
echo "üîß CONFLICTO SOLUCIONADO:"
echo "   - Detener contenedores prod"
echo "   - Limpiar puertos ocupados"
echo "   - Reconstruir con nuevo c√≥digo" 